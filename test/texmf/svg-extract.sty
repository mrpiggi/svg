%%
%% This is file `svg-extract.sty',
%% generated with the docstrip utility.
%%
%% The original source files were:
%%
%% svg.dtx  (with options: `package,option,extract')
%% svg.dtx  (with options: `package,body,extract')
%% 
%% svg-extract -- Extract detached graphic files from SVG pictures
%% 
%% Copyright (C) Philip Ilten <philten@cern.ch>,  2012-2016
%% Copyright (C) Falk Hanisch <hanisch.latex@outlook.com>, 2016-2017
%% 
%% This file was generated from file svg.dtx.
%% ----------------------------------------------------------------------------
%% 
%% This work may be distributed and/or modified under the conditions
%% of the LaTeX Project Public License, version 1.3c of the license.
%% The latest version of this license is in
%%     http://www.latex-project.org/lppl.txt
%% and version 1.3c or later is part of all distributions of
%% LaTeX 2005/12/01 or later and of this work.
%% 
%% This work has the LPPL maintenance status "author-maintained".
%% 
%% The current maintainer and author of this work is Falk Hanisch.
%% 
%% This work consists of the main source file svg.dtx
%% and the derived files
%%     README
%%     svg.dtx (with derived files svg.sty, svg.pdf, Fig.1a.pdf, Fig.1b.eps,
%%     Fig.2.pdf, Fig.2.png),
%%     preamble.tex, example.svg (with derived files example.pdf and
%%     example.pdf_tex),
%%     root.C (with derived files root.svg, root.pdf, and root.pdf_tex).
%% 
\NeedsTeXFormat{LaTeX2e}
\ProvidesPackage{svg-extract}[%
  2016/00/00 v2.00\space%
  (extract detached graphics from SVG pictures)%
]
\RequirePackage{svg-new}[2016/00/00]
\DefineFamily{SVG}
\DefineFamilyMember{SVG}
\newcommand*\svgx@mode{0}
\DefineFamilyKey{SVG}{extract}[true]{%
  \FamilySetNumerical{SVG}{extract}{svg@tempa}{%
    {false}{0},{off}{0},{no}{0},%
    {true}{1},{on}{1},{yes}{1},{onlynewer}{1},{newer}{1},%
    {overwrite}{1},{force}{1},{forced}{1},%
    {pdf}{2},{eps}{3},{ps}{4}%
  }{#1}%
  \ifx\FamilyKeyState\FamilyKeyStateProcessed%
    \ifcase\svg@tempa\relax% false
      \let\svgx@mode\svg@tempa%
    \or% true
      \let\svgx@mode\svg@tempa%
    \or% pdf
      \FamilyOptions{SVG}{extractformat=pdf}%
    \or% eps
      \FamilyOptions{SVG}{extractformat=eps}%
    \or% ps
      \FamilyOptions{SVG}{extractformat=ps}%
    \fi%
  \fi%
}
\DeclareOption{on}{\FamilyOptions{SVG}{extract=true}}
\DeclareOption{off}{\FamilyOptions{SVG}{extract=false}}
\newcommand*\svgx@format{pdf}
\ifxetex\else\ifpdf\else
  \renewcommand*\svgx@format{eps}
\fi\fi
\newcommand*\svgx@cnv@in[1]{}
\let\svgx@cnv@in\svgx@format
\DefineFamilyKey{SVG}{extractformat}{%
  \renewcommand*\svgx@format{#1}%
  \FamilyKeyStateProcessed%
}
\newcommand*\svgx@out@path{}
\newcommand*\svgx@out@name{\svg@out@name-extract}
\newcommand*\svgx@out@base{\svgx@out@path\svgx@out@name}
\DefineFamilyKey{SVG}{extractpath}{%
  \FamilySetNumerical{SVG}{extractpath}{svg@tempa}{%
    {svgpath}{0},{svgdir}{0},%
    {svgsubpath}{1},{svgsubdir}{1},%
    {basepath}{2},{basedir}{2},{jobpath}{2},{jobdir}{2},%
    {basesubpath}{3},{basesubdir}{3},{jobsubpath}{3},{jobsubdir}{3}%
  }{#1}%
  \ifx\FamilyKeyState\FamilyKeyStateProcessed%
    \ifcase\svg@tempa\relax% svgpath
      \renewcommand*\svgx@out@path{\svg@file@path}%
    \or% svgsubpath
      \renewcommand*\svgx@out@path{\svg@file@path svg-extract/}%
    \or% basepath
      \renewcommand*\svgx@out@path{./}%
    \or% basesubpath
      \renewcommand*\svgx@out@path{./svg-extract/}%
    \fi%
  \else%
    \renewcommand*\svgx@out@path{#1}%
    \svg@normalize@path{\svgx@out@path}%
    \FamilyKeyStateProcessed%
  \fi%
}
\DefineFamilyKey{SVG}{path}{%
  \svg@deprecated@key[svg-extract]{path=#1}{extractpath=#1}%
}
% DOC aktuelle figure nummerierung (fast) unmöglich, da unterschiedliche Pakete
\DefineFamilyKey{SVG}{extractname}{%
  \renewcommand*\svgx@out@name{#1\svg@file@ext-extract}%
  \FamilyKeyStateProcessed%
}
\DefineFamilyKey{SVG}{name}{%
  \svg@deprecated@key[svg-extract]{name=#1}{extractname=#1}%
}
\newcommand*\svgx@preamble{\jobname.\svgx@ext@latex}%
\DefineFamilyKey{SVG}{extractpreamble}{%
  \renewcommand*\svgx@preamble{#1}%
  \FamilyKeyStateProcessed%
}
\DefineFamilyKey{SVG}{preamble}{%
  \svg@deprecated@key[svg-extract]{preamble=#1}{extractpreamble=#1}%
}
\newcommand*\svgx@endpreamble{}
\expandafter\def\expandafter\svgx@endpreamble\expandafter{%
  \csname begin\endcsname{document}%
}
\DefineFamilyKey{SVG}{extractpreambleend}{%
  \renewcommand*\svgx@endpreamble{#1}%
  \FamilyKeyStateProcessed%
}
\DefineFamilyKey{SVG}{end}{%
  \svg@deprecated@key[svg-extract]{end=#1}{extractpreambleend=#1}%
}
\let\svghidepreamblestart\relax
\let\svghidepreambleend\relax
\newcounter{svgx@runs}
\DefineFamilyKey{SVG}{extractruns}{%
  \FamilySetCounter{SVG}{extractruns}{svgx@runs}{#1}%
  \ifx\FamilyKeyState\FamilyKeyStateProcessed%
    \ifnum\value{svgx@runs}<\@ne\relax%
      \PackageWarning{svg-extract}{%
        The count for runs has to be at least one%
      }%
      \FamilySetCounter{SVG}{extractruns}{svgx@runs}{\@ne}%
    \fi%
  \fi%
}
\ifxetex
  \newcommand*\svgx@exe@latex{xelatex}
\else\ifluatex
  \ifpdf
    \newcommand*\svgx@exe@latex{lualatex}
  \else
    \newcommand*\svgx@exe@latex{lualatex --output-format=dvi}
  \fi
\else\ifpdf
  \newcommand*\svgx@exe@latex{pdflatex}
\else
  \newcommand*\svgx@exe@latex{latex}
\fi\fi\fi
\DefineFamilyKey{SVG}{latexexe}{%
  \renewcommand*\svgx@exe@latex{#1}%
  \FamilyKeyStateProcessed%
}
\newcommand*\svgx@opt@latex{}
\DefineFamilyKey{SVG}{latexopt}{%
  \renewcommand*\svgx@opt@latex{#1}%
  \FamilyKeyStateProcessed%
}
\newcommand*\svgx@ext@latex{tex}
\DefineFamilyKey{SVG}{latexext}{%
  \renewcommand*\svgx@ext@latex{#1}%
  \FamilyKeyStateProcessed%
}
\newcommand*\svgx@exe@dvips{dvips}
\newcommand*\svgx@opt@dvips{}
\DefineFamilyKey{SVG}{dvipsopt}{%
  \renewcommand*\svgx@opt@dvips{#1}%
  \FamilyKeyStateProcessed%
}
\newcommand*\svgx@exe@pstoeps{ps2eps}
\newcommand*\svgx@opt@pstoeps{-B -C}
\DefineFamilyKey{SVG}{pstoepsopt}{%
  \renewcommand*\svgx@opt@pstoeps{#1}%
  \FamilyKeyStateProcessed%
}
\newcommand*\svgx@exe@pstopdf{ps2pdf}
\newcommand*\svgx@opt@pstopdf{}
\DefineFamilyKey{SVG}{pstopdfopt}{%
  \renewcommand*\svgx@opt@pstopdf{#1}%
  \FamilyKeyStateProcessed%
}
\newcommand*\svgx@exe@pdftops{pdftops}
\newcommand*\svgx@opt@pdftops{}
\DefineFamilyKey{SVG}{pdftopsopt}{%
  \renewcommand*\svgx@opt@pdftops{#1}%
  \FamilyKeyStateProcessed%
}
\newcommand*\svgx@exe@pdftoeps{pdftops -eps}
\newcommand*\svgx@opt@pdftoeps{}
\DefineFamilyKey{SVG}{pdftoepsopt}{%
  \renewcommand*\svgx@opt@pdftoeps{#1}%
  \FamilyKeyStateProcessed%
}
\newcommand*\svgx@param@width{\svg@param@width}
\DefineFamilyKey{SVG}{extractwidth}{%
  \FamilyKeyStateUnknownValue%
  \svg@ifvalueisrelax{#1}{%
    \renewcommand*\svgx@param@width{\z@}%
    \FamilyKeyStateProcessed%
  }{%
    \ifstr{#1}{inherit}{%
      \renewcommand*\svgx@param@width{\svg@param@width}%
      \FamilyKeyStateProcessed%
    }{%
      \FamilySetLengthMacro{SVG}{extractwidth}{\svgx@param@width}{#1}%
      \ifdim\svgx@param@width<\z@\relax%
        \FamilyKeyStateUnknownValue%
      \fi%
    }%
  }%
}
\newcommand*\svgx@param@height{\svg@param@height}
\DefineFamilyKey{SVG}{extractheight}{%
  \FamilyKeyStateUnknownValue%
  \svg@ifvalueisrelax{#1}{%
    \renewcommand*\svgx@param@height{\z@}%
    \FamilyKeyStateProcessed%
  }{%
    \ifstr{#1}{inherit}{%
      \renewcommand*\svgx@param@height{\svg@param@height}%
      \FamilyKeyStateProcessed%
    }{%
      \FamilySetLengthMacro{SVG}{extractheight}{\svgx@param@height}{#1}%
      \ifdim\svgx@param@height<\z@\relax%
        \FamilyKeyStateUnknownValue%
      \fi%
    }%
  }%
}
\newcommand*\svgx@param@scale{\svg@param@scale}
\DefineFamilyKey{SVG}{extractscale}{%
  \FamilyKeyStateUnknownValue%
  \svg@ifvalueisrelax{#1}{%
    \renewcommand*\svgx@param@scale{1}%
    \FamilyKeyStateProcessed%
  }{%
    \ifstr{#1}{inherit}{%
      \renewcommand*\svgx@param@scale{\svg@param@scale}%
      \FamilyKeyStateProcessed%
    }{%
      \ifisdimension{#1\p@}{%
        \ifdim\dimexpr#1\p@\relax>\z@\relax%
          \renewcommand*\svgx@param@scale{#1}%
          \FamilyKeyStateProcessed%
        \fi%
      }{}%
    }%
  }%
}
\newcommand*\svgx@param@pretex{\svg@param@pretex}
\DefineFamilyKey{SVG}{extractpretex}{%
  \svg@ifvalueisrelax{#1}{%
    \let\svgx@param@pretex\relax%
  }{%
    \ifstr{#1}{inherit}{%
      \def\svgx@param@pretex{\svg@param@pretex}%
    }{%
      \def\svgx@param@pretex{#1}%
    }%
  }%
  \FamilyKeyStateProcessed%
}
\newcommand*\svgx@param@apptex{\svg@param@apptex}
\DefineFamilyKey{SVG}{extractapptex}{%
  \svg@ifvalueisrelax{#1}{%
    \let\svgx@param@apptex\relax%
  }{%
    \ifstr{#1}{inherit}{%
      \def\svgx@param@apptex{\svg@param@apptex}%
    }{%
      \def\svgx@param@apptex{#1}%
    }%
  }%
  \FamilyKeyStateProcessed%
}
\DefineFamilyKey{SVG}{extractpostex}{%
  \svg@deprecated@key[svg-extract]{extractpostex=#1}{extractapptex=#1}%
}
\newif\if@svgx@cnv@run
\newcommand*\svgx@cnv@cmd{\svgx@magick@cmd}
\DefineFamilyKey{SVG}{convert}[true]{%
  \FamilySetNumerical{SVG}{convert}{svg@tempa}{%
    {false}{0},{off}{0},{no}{0},%
    {true}{1},{on}{1},{yes}{1},{onlynewer}{1},{newer}{1},%
    {overwrite}{1},{force}{1},{forced}{1},%
    {magick}{2},{imagemagick}{2},%
    {gs}{3},{ghostscript}{3},%
    {gs64}{4},{ghostscript64}{4},%
    {gs32}{5},{ghostscript32}{5}%
  }{#1}%
  \ifx\FamilyKeyState\FamilyKeyStateProcessed%
    \ifcase\svg@tempa\relax% false
      \@svgx@cnv@runfalse%
    \or% true
      \@svgx@cnv@runtrue%
    \or% magick
      \@svgx@cnv@runtrue%
      \renewcommand*\svgx@cnv@cmd{\svgx@magick@cmd}%
    \or% gs
      \@svgx@cnv@runtrue%
      \renewcommand*\svgx@cnv@cmd{\svgx@gs@cmd}%
    \or% gs64
      \@svgx@cnv@runtrue%
      \renewcommand*\svgx@cnv@cmd{\svgx@gs@cmd}%
      \svgx@onlywindows{%
        \renewcommand*\svgx@gs@exe{gswin64c}%
      }%
    \or% gs32
      \@svgx@cnv@runtrue%
      \renewcommand*\svgx@cnv@cmd{\svgx@gs@cmd}%
      \svgx@onlywindows{%
        \renewcommand*\svgx@gs@exe{gswin32c}%
      }%
    \fi%
  \fi%
}
\newcommand*\svgx@cnv@format{png}
\DefineFamilyKey{SVG}{convertformat}{%
  \renewcommand*\svgx@cnv@format{#1}%
  \FamilyKeyStateProcessed%
}
\newcommand*\svgx@cnv@dpi{}
\let\svgx@cnv@dpi\relax
\DefineFamilyKey{SVG}{convertdpi}{%
  \FamilyKeyStateUnknownValue%
  \svgx@ifkeyandval{#1}{%
    \svgx@cnv@get@dpi{##2}%
    \ifx\svg@tempa\relax\else%
      \expandafter\edef\csname svgx@cnv@dpi@##1\endcsname{\svg@tempa}%
      \FamilyKeyStateProcessed%
    \fi%
  }{%
    \svgx@cnv@get@dpi{##1}%
    \ifx\svg@tempa\relax\else%
      \edef\svgx@cnv@dpi{\svg@tempa}%
      \FamilyKeyStateProcessed%
    \fi%
  }%
}
\DefineFamilyKey{SVG}{convertdensity}{\FamilyOptions{SVG}{convertdpi=#1}}
\newcommand*\svgx@magick@exe{}
\DefineFamilyKey{SVG}{magickexe}{%
  \renewcommand*\svgx@magick@exe{#1}%
  \FamilyKeyStateProcessed%
}
\newcommand*\svgx@magick@set{}
\DefineFamilyKey{SVG}{magicksetting}{%
  \svgx@settypekey{#1}{svgx@magick@set}%
  \FamilyKeyStateProcessed%
}
\newcommand*\svgx@magick@opr{}
\DefineFamilyKey{SVG}{magickoperator}{%
  \svgx@settypekey{#1}{svgx@magick@opr}%
  \FamilyKeyStateProcessed%
}
\newcommand*\svgx@gs@exe{}
\DefineFamilyKey{SVG}{gsexe}{%
  \renewcommand*\svgx@gs@exe{#1}%
  \FamilyKeyStateProcessed%
}
\newcommand*\svgx@gs@opt{}
\DefineFamilyKey{SVG}{gsopt}{%
  \svgx@settypekey{#1}{svgx@gs@opt}%
  \FamilyKeyStateProcessed%
}
\newcommand*\svgx@gs@device{}
\DefineFamilyKey{SVG}{gsdevice}{%
  \svgx@settypekey{#1}{svgx@gs@device}%
  \FamilyKeyStateProcessed%
}
\newcommand*\svgx@clean{}
\DefineFamilyKey{SVG}{clean}{%
  \FamilySetBool{SVG}{clean}{@svg@tempswa}{#1}%
  \ifx\FamilyKeyState\FamilyKeyStateProcessed%
    \if@svg@tempswa%
      \renewcommand*\svgx@clean{log,aux,dvi,ps,eps,pdf,\svgx@ext@latex}%
    \else%
      \renewcommand*\svgx@clean{}%
    \fi%
  \else%
    \renewcommand*\svgx@clean{#1}%
    \FamilyKeyStateProcessed%
  \fi%
}
\DefineFamilyKey{SVG}{clear}{\FamilyOptions{SVG}{clean=#1}}
\DefineFamilyKey{SVG}{exclude}[true]{%
  \FamilySetBool{SVG}{exclude}{@svg@tempswa}{#1}%
  \ifx\FamilyKeyState\FamilyKeyStateProcessed%
    \if@svg@tempswa%
      \renewcommand*\svg@input[2][]{%
        \ifnum\svgx@mode=\z@\relax%
          \PackageWarning{svg-extract}{%
            The image was neither extracted nor included%
          }%
        \fi%
      }%
    \else%
      \renewcommand*\svg@input{\svg@@input}%
    \fi%
  \fi%
}
\newcommand*\svgx@ifkeyandval[3]{%
  \def\svg@tempa##1=##2=##3\@nil{\ifstr{##3}{=}{#2}{#3}}%
  \svg@tempa#1==\@nil%
}
% TODO: kann man doch auch direkt prüfen, ob \ifx##2\relax, oder?
% TODO mit \svg@ifvalueisrelax{#1}?
\newcommand*\svgx@settypekey[2]{%
  \svgx@ifkeyandval{#1}{%
    \expandafter\edef\csname #2@##1\endcsname{##2}%
    \expandafter\expandafter\expandafter\ifx\csname #2@##1\endcsname\relax%
      \expandafter\let\csname #2@##1\endcsname\relax%
    \fi%
  }{%
    \expandafter\edef\csname #2\endcsname{##1}%
    \expandafter\expandafter\expandafter\ifx\csname ##1\endcsname\relax%
      \expandafter\let\csname ##1\endcsname\relax%
    \fi%
  }%
}
\newcommand*\svgx@usetypekey[3]{%
  \scr@ifundefinedorrelax{#1@#2}{%
    \scr@ifundefinedorrelax{#1}{}{%
      \expandafter\ifx\csname #1\endcsname\@empty\else%
        #3\@nameuse{#1}\space%
      \fi%
    }%
    \scr@ifundefinedorrelax{#1@#2+}{}{%
      \expandafter\ifx\csname #1@#2+\endcsname\@empty\else%
        #3\@nameuse{#1@#2+}\space%
      \fi%
    }%
  }{%
    \expandafter\ifx\csname #1@#2\endcsname\@empty\else%
      #3\@nameuse{#1@#2}\space%
    \fi%
  }%
}
\newcommand*\svgx@magick@cmd[3]{%
  \svgx@magick@exe\space%
  \svgx@usetypekey{svgx@cnv@dpi}{#3}{-density }%
  \svgx@usetypekey{svgx@magick@set}{#3}{}%
  "#1.#2"\space%
  \svgx@usetypekey{svgx@magick@opr}{#3}{}%
  "#1.#3"%
}
\newcommand*\svgx@gs@cmd[3]{%
  \svgx@gs@exe\space-dSAFER -dBATCH -dNOPAUSE\space%
  \svgx@usetypekey{svgx@gs@device}{#3}{-sDEVICE=}%
  \svgx@usetypekey{svgx@cnv@dpi}{#3}{-r}%
  \svgx@usetypekey{svgx@gs@opt}{#3}{}%
  -sOutputFile="#1.#3"\space"#1.#2"%
}
\newcommand*\svgx@onlywindows[1]{}
\AfterPackage*{ifplatform}{\renewcommand*\svgx@onlywindows[1]{\ifwindows#1\fi}}
\newcommand*\svgx@cnv@get@dpi[1]{%
  \begingroup%
    \def\svg@tempb##1x##2x##3\@nil{%
      \ifstr{##3}{x}{%
        \ifnumber{##1}{%
          \ifnumber{##2}{%
            \edef\svg@tempa{##1x##2}%
            \@svg@tempswafalse%
          }{}%
        }{}%
      }{}%
    }%
    \def\svg@tempa##1dpi##2x##3dpi##4\@nil{%
      \edef\svg@tempa{##1}%
      \@svg@tempswatrue%
      \ifnumber{##1}{%
        \IfArgIsEmpty{##3}{\@svg@tempswafalse}{%
          \ifnumber{##3}{\edef\svg@tempa{##1x##3}}{}%
        }%
      }{}%
      \if@svg@tempswa%
        \expandafter\svg@tempb\svg@tempa xx\@nil%
      \fi%
    }%
    \IfArgIsEmpty{#1}{%
      \let\svg@tempa\@empty%
      \@svg@tempswafalse%
    }{%
      \svg@tempa#1dpi#1xdpi\@nil%
      \if@svg@tempswa%
        \let\svg@tempa\relax%
      \fi%
    }%
    \edef\svg@tempb{%
      \noexpand\endgroup%
      \ifx\svg@tempa\relax%
        \noexpand\let\noexpand\svg@tempa\noexpand\relax%
      \else%
        \noexpand\edef\noexpand\svg@tempa{\svg@tempa}%
      \fi%
    }%
  \svg@tempb%
}
\FamilyExecuteOptions{SVG}{%
  extract=true,extractpath=basesubdir,extractruns=2,%
  gsdevice={png=png16m},gsdevice={jpeg=jpeg},gsdevice={jpg=jpeg},%
  gsdevice={tif=tiff48nc},gsdevice={tiff=tiff48nc},%
  gsdevice={eps=eps2write},gsdevice={ps=ps2write}%
}
\FamilyProcessOptions{SVG}
\newif\if@svgx@beamer
\@ifclassloaded{beamer}{\@svgx@beamertrue}{}%
\newbox\svgx@box
\newcommand*\svgxinput[2][]{%
  \sbox\svgx@box{\svg@@input[#1,draft=false]{#2}}%
}
\newcommand*\svgxsetpapersize{%
  \setlength\paperwidth{\the\wd\svgx@box}%
  \ifx\stockwidth\@undefined\else%
    \setlength\stockwidth{\paperwidth}%
  \fi%
  \ifx\mediawidth\@undefined\else%
    \setlength\mediawidth{\paperwidth}%
  \fi%
  \setlength\textwidth{\paperwidth}%
  \setlength\paperheight{\the\dimexpr\ht\svgx@box+\dp\svgx@box\relax}%
  \ifx\stockheight\@undefined\else%
    \setlength\stockheight{\paperheight}%
  \fi%
  \ifx\mediaheight\@undefined\else%
    \setlength\mediaheight{\paperheight}%
  \fi%
  \setlength\textheight{\paperheight}%
  \hoffset=-1in%
  \oddsidemargin=\z@%
  \evensidemargin=\z@%
  \voffset=-1in%
  \topmargin=\z@%
  \headheight=\z@%
  \headsep=\z@%
  \topskip=\z@%
  \footskip=\z@%
  \marginparsep=\z@%
  \marginparwidth=\z@%
  \marginparpush=\z@%
}
\@onlypreamble\svgxsetpapersize
\newcommand*\svgxoutput{%
  \begingroup%
    \setlength\parindent{\z@}%
    \setlength\parskip{\z@}%
    \setlength\parfillskip{\z@}%
    \if@svgx@beamer%
      \setbeamertemplate{navigation symbols}{}%
      \begin{frame}[plain]%
      \usebox\svgx@box%
      \end{frame}%
    \else%
      \pagestyle{empty}%
      \usebox\svgx@box%
    \fi%
    \endgraf%
  \endgroup%
}
\newcommand*\svgx@ifinlist[2]{%
  \begingroup%
    \def\svg@tempa##1,#1,##2\@nil{%
      \IfArgIsEmpty{##2}{%
        \aftergroup\@secondoftwo%
      }{%
        \aftergroup\@firstoftwo%
      }%
    }%
    \expandafter\svg@tempa\expandafter,#2,#1,\@nil%
  \endgroup%
}
\ifnum\pdf@shellescape=\@ne\relax\else%
  \renewcommand*\svg@extract[1]{%
    \ifnum\svgx@mode>\z@\relax%
      \begingroup%
        \edef\svg@tempa{#1}%
        \svg@quotes@remove{\svg@tempa}%
        \PackageWarning{svg-extract}{%
          You didn't enable `shell escape' (or `write18')\MessageBreak%
          so it wasn't possible to run the extraction for\MessageBreak%
          file `\svg@tempa'%
        }%
      \endgroup%
    \fi%
  }%
  \expandafter\endinput%
\fi
\newif\if@svgx@write@do{}
\newwrite\svgx@write@out%
\newread\svgx@read@in%
\newcommand*\svgx@read@line{}%
\renewcommand*\svg@extract[1]{%
  \ifnum\svgx@mode>\z@\relax%
    \begingroup%
      \endlinechar=\m@ne%
      \def\svgx@read@line{}%
      \immediate\openout\svgx@write@out=\svgx@out@name.\svgx@ext@latex%
      \IfFileExists{\svgx@preamble}{%
        \immediate\openin\svgx@read@in=\svgx@preamble%
        \@svg@tempswatrue%
        \@svgx@write@dotrue%
        \@whilesw\if@svg@tempswa\fi{%
          \immediate\read\svgx@read@in to\svgx@read@line%
          \ifx\svgx@read@line\@empty%
            \ifeof\svgx@read@in\@svg@tempswafalse\fi%
          \else%
            \svgx@write@till{\svghidepreamblestart}{}%
            \svgx@write@from{\svghidepreambleend}{}%
            \svgx@write@till{\svgx@endpreamble}{\@svg@tempswafalse}%
            \if@svgx@write@do%
              \if@svgx@classfound\else%
                \expandafter\svgx@documentclass%
                  \svgx@read@line\documentclass\documentclass\@nil%
              \fi%
              \ifx\svgx@read@line\@empty\else%
                \immediate\write\svgx@write@out{%
                  \unexpanded\expandafter{\svgx@read@line}%
                }%
              \fi%
            \fi%
          \fi%
        }%
        \immediate\closein\svgx@read@in%
      }{%
        \svg@quotes@remove{\svgx@preamble}%
        \ifx\svgx@preamble\@empty\else%
          \PackageWarning{svg-extract}{%
            The preamble file `\svgx@preamble'\MessageBreak%
            does not exist%
          }%
        \fi%
      }%
      \immediate\closeout\svgx@write@out%
      \immediate\openin\svgx@read@in=\svgx@out@name.\svgx@ext@latex%
      \def\svg@tempa{}%
      \loop\unless\ifeof\svgx@read@in%
        \readline\svgx@read@in to\svgx@read@line%
        \ifx\svgx@read@line\@empty\else%
          \edef\svg@tempa{%
            \unexpanded\expandafter{\svg@tempa}%
            \unexpanded\expandafter{\svgx@read@line}^^J%
          }%
        \fi%
      \repeat%
      \immediate\closein\svgx@read@in%
      \immediate\openout\svgx@write@out=\svgx@out@name.\svgx@ext@latex%
      \immediate\write\svgx@write@out{%
        \string\AtBeginDocument{\string\svgxsetpapersize}\@percentchar^^J%
      }%
      \if@svgx@classfound\else%
        \immediate\write\svgx@write@out{\string\documentclass{article}}%
      \fi%
      \immediate\write\svgx@write@out{\unexpanded\expandafter{\svg@tempa}}%
      \immediate\write\svgx@write@out{\string\usepackage{svg-extract}}%
      \def\svg@tempa##1{%
        \immediate\write\svgx@write@out{\string\svgsetup{##1}}%
      }%
      \if@svg@ink@latex\else%
        \svg@tempa{inkscapelatex=false}%
      \fi%
      \ifdim\svgx@param@width>\z@\relax%
        \svg@tempa{width=\svgx@param@width}%
      \fi%
      \ifdim\svgx@param@height>\z@\relax%
        \svg@tempa{height=\svgx@param@height}%
      \fi%
      \ifdim\dimexpr\svgx@param@scale\p@\relax=\p@\relax\else%
        \svg@tempa{scale=\svgx@param@scale}%
      \fi%
      \def\svg@tempb{\svg@param@pretex}%
      \ifx\svgx@param@pretex\svg@tempb\relax%
        \let\svgx@param@pretex\svg@param@pretex%
      \fi%
      \ifx\svgx@param@pretex\relax\else%
        \svg@tempa{pretex=\unexpanded\expandafter{\svgx@param@pretex}}%
      \fi%
      \def\svg@tempb{\svg@param@apptex}%
      \ifx\svgx@param@apptex\svg@tempb\relax%
        \let\svgx@param@apptex\svg@param@apptex%
      \fi%
      \ifx\svgx@param@apptex\relax\else%
        \svg@tempa{apptex=\unexpanded\expandafter{\svgx@param@apptex}}%
      \fi%
      % TODO: alle Varianten mit lastpage durchtesten
      % TODO: falls auto gesetzt war, dann berechneten wert direkt eintragen!
      \ifnum\value{svg@param@lastpage}>\z@\relax%
        \immediate\write\svgx@write@out{%
          \string\svgxinput[lastpage=\the\value{svg@param@lastpage}]{#1}%
        }%
      \else%
        \ifnum\value{svg@param@lastpage}=\z@\relax%
          \immediate\write\svgx@write@out{%
            \string\svgxinput[lastpage=true]{#1}%
          }%
        \else%
          \immediate\write\svgx@write@out{%
            \string\svgxinput[lastpage=false]{#1}%
          }%
        \fi%
      \fi%
      \immediate\write\svgx@write@out{%
        \string\usepackage{xr}^^J%
        \string\externaldocument{\jobname}^^J%
        \string\svgxsetpapersize^^J%
        \string\AtBeginDocument{\string\svgxsetpapersize}^^J%
        \string\begin{document}^^J%
        \string\svgxoutput\@percentchar^^J%
        \string\end{document}%
      }%
      \immediate\closeout\svgx@write@out%
    \endgroup%
    \ifstr{\svgx@format\svgx@cnv@format}{}{%
      \PackageWarning{svg-extract}{%
        Both keys `extractformat' and `convertformat' are\MessageBreak%
        empty, so nothing to do so far%
      }%
    }{%
      \svg@quotes@remove{\svgx@out@path}%
      \svg@quotes@remove{\svgx@out@name}%
      \PackageInfo{svg-extract}{%
        Running LaTeX for graphic extraction%
        \ifx\svgx@opt@latex\@empty\else%
          \space with added options `\svgx@opt@latex'%
        \fi%
      }%
      \loop\ifnum\value{svgx@runs}>\z@\relax%
        \ShellEscape{%
          \svgx@exe@latex\space\svgx@opt@latex\space%
          "\svgx@out@name.\svgx@ext@latex"%
        }%
        \advance\c@svgx@runs\m@ne%
      \repeat%
      \def\svg@tempa##1##2##3{%
        \edef\svg@tempb{%
          \@nameuse{svgx@exe@##1}\space\@nameuse{svgx@opt@##1}\space%
          "\svgx@out@name.##2"%
        }%
        \PackageInfo{svg-extract}{Running ##1}%
        \ShellEscape{\svg@tempb}%
      }%
      \@svg@tempswafalse%
      \ifxetex\else\ifpdf\else%
        \@svg@tempswatrue%
      \fi\fi%
      \if@svg@tempswa%
        \svg@tempa{dvips}{dvi}{ps}%
        \svgx@ifinlist{eps}{\svgx@format}{\svg@tempa{pstoeps}{ps}{eps}}{}%
        \svgx@ifinlist{pdf}{\svgx@format}{\svg@tempa{pstopdf}{ps}{pdf}}{}%
      \else%
        \svgx@ifinlist{ps}{\svgx@format}{\svg@tempa{pdftops}{pdf}{ps}}{}%
        \svgx@ifinlist{eps}{\svgx@format}{\svg@tempa{pdftoeps}{pdf}{eps}}{}%
      \fi%
      \if@svgx@cnv@run%
        \ifx\svgx@cnv@dpi\relax%
          \ifx\svgx@cnv@dpi@png\@undefined%
            \def\svgx@cnv@dpi@png{300}%
          \fi%
        \fi%
        \expandafter\svgx@cnv@get@input\expandafter{\svgx@format}%
        \@for\svg@tempa:=\svgx@cnv@format\do{%
          \ifx\svg@tempa\@empty\else%
            \PackageInfo{svg-extract}{%
              Converting `\svgx@out@name.\svgx@cnv@in'\MessageBreak%
              to `\svgx@out@name.\svg@tempa'%
            }%
            \ShellEscape{%
              \svgx@cnv@cmd{\svgx@out@name}{\svgx@cnv@in}{\svg@tempa}%
            }%
          \fi%
        }%
      \fi%
      \svg@shell@mkdir{\svgx@out@path}%
      \edef\svg@tempb{\svgx@format,\svgx@cnv@format}%
      \@for\svg@tempa:=\svg@tempb\do{%
        \ifx\svg@tempa\@empty\else%
          \svgx@checkandmove{\svgx@out@name}{\svg@tempa}{\svgx@out@base}%
        \fi%
      }%
      \@for\svg@tempa:=\svgx@clean\do{%
        \expandafter\svgx@ifinlist\expandafter{\svg@tempa}{\svg@tempb}{}{%
          \IfFileExists{"\svgx@out@name".\svg@tempa}{%
            \svg@shell@rm{\svgx@out@name.\svg@tempa}%
          }{}%
        }%
      }%
    }%
  \fi%
}
\newcommand*\svgx@cnv@get@input[1]{%
  \begingroup%
    \def\svg@tempa##1,##2\@nil{%
      \def\svg@tempa{##1}%
    }%
    \svg@tempa#1,\@nil%
    \edef\svg@tempa{%
      \noexpand\endgroup%
      \noexpand\def\noexpand\svgx@cnv@in{\svg@tempa}%
    }%
  \svg@tempa%
  \ifx\svgx@cnv@in\@empty%
    \renewcommand*\svgx@cnv@in{pdf}%
    \ifxetex\else\ifpdf\else%
      \renewcommand*\svgx@cnv@in{ps}%
    \fi\fi%
  \fi%
}
\ifx\svgx@magick@exe\@empty
  \ifwindows
    \renewcommand*\svgx@magick@exe{magick}
  \else
    \renewcommand*\svgx@magick@exe{convert}
  \fi
\fi
\ifx\svgx@gs@exe\@empty
  \ifwindows
    \renewcommand*\svgx@gs@exe{gswin64c}
  \else
    \renewcommand*\svgx@gs@exe{gs}
  \fi
\fi
\newcommand*\svgx@checkandmove[3]{%
  \begingroup%
    \IfFileExists{"#1".#2}{%
      \svg@shell@move{#1.#2}{#3.#2}%
    }{%
      \edef\svg@tempa{#2}%
      \@svg@tempswafalse%
      \expandafter\svgx@ifinlist\expandafter{\svg@tempa}{pdf,ps,eps}{%
        \@svg@tempswatrue%
        \def\svg@tempb{extraction}%
      }{%
        \expandafter\svgx@ifinlist\expandafter{\svg@tempa}{\svgx@cnv@format}{%
          \@svg@tempswatrue%
          \def\svg@tempb{conversion}%
        }{}%
      }%
      \if@svg@tempswa%
        \edef\svg@tempb{%
          The graphic file \svg@tempb\space failed\MessageBreak%
          for `#1.#2'\MessageBreak%
          Troubleshooting: Please check in the log file how\MessageBreak%
          the invocation of the extraction took place and\MessageBreak%
          try to execute it yourself in the terminal%
        }%
      \else%
        \def\svg@tempb{%
          The extraction to format `#2' failed\MessageBreak%
          for `#1.#2'\MessageBreak%
          Only file types `pdf,ps,eps' are supported for\MessageBreak%
          key `exportformat'%
        }%
      \fi%
      \PackageWarning{svg-extract}{\svg@tempb}%
    }%
  \endgroup%
}
\newif\if@svgx@classfound
\newcommand*\svgx@documentclass{}
\def\svgx@documentclass#1\documentclass#2\documentclass#3\@nil{%
  \IfArgIsEmpty{#2}{}{\@svgx@classfoundtrue}%
}
\newcommand*\svgx@write@skip{}
\def\svgx@write@skip#1\@nil#2#3{%
  \def\svg@tempa##1{%
    \def\svg@tempa####1##1####2##1####3\@nil{%
      \IfArgIsEmpty{####3}{}{%
        \ifstr{#2}{till}{%
          \IfArgIsEmpty{####1}{}{%
            \immediate\write\svgx@write@out{####1}%
          }%
          \@svgx@write@dofalse%
        }{%
          \ifstr{#2}{from}{%
            \IfArgIsEmpty{####2}{%
              \def\svgx@read@line{}%
            }{%
              \def\svgx@read@line{####2}%
            }%
            \@svgx@write@dotrue%
          }{}%
        }%
        #3%
      }%
    }%
  }%
  \edef\svg@tempb{\expandafter\detokenize\expandafter{#1}}%
  \expandafter\svg@tempa\expandafter{\svg@tempb}%
  \edef\svg@tempb{%
    \expandafter\detokenize\expandafter{\svgx@read@line}\svg@tempb\svg@tempb%
  }%
  \expandafter\svg@tempa\svg@tempb\@nil%
}
\newcommand*\svgx@write@till[2]{%
  \svgx@write@skip#1\@nil{till}{#2}%
}
\newcommand*\svgx@write@from[2]{%
  \svgx@write@skip#1\@nil{from}{#2}%
}
\endinput
%%
%% End of file `svg-extract.sty'.
